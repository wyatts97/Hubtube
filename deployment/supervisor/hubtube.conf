# =============================================================================
# HubTube — Supervisor Configuration
# =============================================================================
# Keeps background services running and auto-restarts them on failure.
#
# Install:
#   sudo cp hubtube.conf /etc/supervisor/conf.d/hubtube.conf
#   sudo supervisorctl reread
#   sudo supervisorctl update
#   sudo supervisorctl start hubtube:*
#
# Commands:
#   sudo supervisorctl status hubtube:*
#   sudo supervisorctl restart hubtube:*
#   sudo supervisorctl stop hubtube:*
#   sudo supervisorctl tail -f hubtube:horizon
# =============================================================================

[group:hubtube]
programs=horizon,reverb,scraper

# -----------------------------------------------------------------------------
# Laravel Horizon — Queue Worker (video processing, cloud offload, etc.)
# -----------------------------------------------------------------------------
[program:horizon]
process_name=%(program_name)s
command=php /var/www/hubtube/artisan horizon
autostart=true
autorestart=true
user=www-data
redirect_stderr=true
stdout_logfile=/var/www/hubtube/storage/logs/horizon-supervisor.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stopwaitsecs=3600
stopsignal=QUIT

# -----------------------------------------------------------------------------
# Laravel Reverb — WebSocket Server
# -----------------------------------------------------------------------------
[program:reverb]
process_name=%(program_name)s
command=php /var/www/hubtube/artisan reverb:start --host=127.0.0.1 --port=8080
autostart=true
autorestart=true
user=www-data
redirect_stderr=true
stdout_logfile=/var/www/hubtube/storage/logs/reverb-supervisor.log
stdout_logfile_maxbytes=5MB
stdout_logfile_backups=3
stopwaitsecs=10

# -----------------------------------------------------------------------------
# Scraper Microservice — Node.js embed scraper
# -----------------------------------------------------------------------------
[program:scraper]
process_name=%(program_name)s
command=node /var/www/hubtube/scraper/src/index.js
directory=/var/www/hubtube/scraper
autostart=true
autorestart=true
user=www-data
redirect_stderr=true
stdout_logfile=/var/www/hubtube/storage/logs/scraper-supervisor.log
stdout_logfile_maxbytes=5MB
stdout_logfile_backups=3
environment=NODE_ENV="production",PORT="3001"
stopwaitsecs=10
